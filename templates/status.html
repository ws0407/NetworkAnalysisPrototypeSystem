<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Prototype System</title>
    {% load static %}
      <!-- daterange picker -->
    <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
    <link rel="icon" href="{% static 'dist/img/logo.png' %}" type="image/x-icon">
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
    <!-- Icon-ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">

    <!-- Ekko Lightbox -->
    <link rel="stylesheet" href="{% static 'plugins/ekko-lightbox/ekko-lightbox.css' %}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
      <!-- uPlot -->
    <link rel="stylesheet" href="{% static 'plugins/uplot/uPlot.min.css' %}">

</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="/home" class="nav-link">主页</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="/contact" class="nav-link">联系我们</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="/help" class="nav-link">帮助</a>
      </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">

      <!-- Messages Dropdown Menu -->
      <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-comments"></i>
          <span class="badge badge-danger navbar-badge">1</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="{% static 'dist/img/thu_logo.png'%}" alt="User Avatar" class="img-size-50 img-circle mr-3">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  Manager
                  <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">This is a test message.</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
        </div>
      </li>
      <!-- Notifications Dropdown Menu -->
      <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-bell"></i>
          <span class="badge badge-warning navbar-badge">15</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <span class="dropdown-item dropdown-header">15 Notifications</span>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item" style="background-color: #dcdccc">
            <i class="fas fa-map-pin mr-2"></i> This is a pinned notice.
            <span class="float-right text-muted text-sm">12 hours</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            >>&nbsp;&nbsp;This is a test notice.
            <span class="float-right text-muted text-sm">3 mins</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            >>&nbsp;&nbsp; This is a test notice, too.
            <span class="float-right text-muted text-sm">2 days</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer">...</a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="fas fa-th-large"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" style="text-align: center">
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            个人主页
          </a>
          <div class="dropdown-divider"></div>
          <a href="/logout" class="dropdown-item">
            退出登录
          </a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-widget="fullscreen" href="#" role="button">
          <i class="fas fa-expand-arrows-alt"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4" style="position: fixed">
    <!-- Brand Logo -->
    <a href="/home" class="brand-link">
      <img src="{% static 'dist/img/logo.png' %}" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light" style="font-size: 20px"><b>&nbsp;原型系统</b></span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="{% static 'dist/img/thu_logo.png' %}" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
            <a href="#" class="d-block"><b>{{ request.session.username }}</b></a>
        </div>
      </div>

      <!-- SidebarSearch Form -->
      <div class="form-inline" style="width: 230px">
        <div class="input-group" data-widget="sidebar-search">
          <input class="form-control form-control-sidebar" type="search" placeholder="查找" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->

          <li class="nav-item">
            <a href="/home" class="nav-link">
              <i class="nav-icon fas fa-home"></i>
              <p>
                概览
              </p>
            </a>
          </li>
          <li class="nav-item" id="Feature-Mining">
            <a href="#" class="nav-link">
              <i class="nav-icon fa fa-cubes"></i>
              <p>
                可扩展的特征挖掘
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview" style="font-size: small">
              <li class="nav-item">
                <a href="/subtask/Flow Monitor Based Gauss Process" class="nav-link" id="Flow-Monitor-Based-Gauss-Process">
                  <i class="far fa-circle nav-icon"></i>
                  <p>基于深度高斯过程的可扩展特征流量预测</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item" id="Feature-Analysis">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-rocket"></i>
              <p>
                多维特征的关联分析
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview" style="font-size: small">
              <li class="nav-item">
                <a href="/subtask/Network Traffic Classification" class="nav-link" id="Network-Traffic-Classification">
                  <i class="far fa-circle nav-icon"></i>
                  <p>基于多维特征关联分析的流量分类</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/subtask/Application Identification" class="nav-link" id="Application-Identification">
                  <i class="far fa-circle nav-icon"></i>
                  <p>网络应用识别</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/subtask/User Behavior Identification" class="nav-link" id="User-Behavior-Identification">
                  <i class="far fa-circle nav-icon"></i>
                  <p>用户行为识别</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item" id="Benchmark">
            <a href="#" class="nav-link">
              <i class="nav-icon fa fa-cubes"></i>
              <p>
                规范性基准构建
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview" style="font-size: small">
              <li class="nav-item">
                <a href="/subtask/BGP Anomaly Detection" class="nav-link" id="BGP-Anomaly-Detection">
                  <i class="far fa-circle nav-icon"></i>
                  <p>基于弱监督学习的BGP规范性基准系统</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="http://[2001:250:200:5::1:220]:60005/" target="_blank" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>恶意域名检测(DNS)</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fa fa-recycle"></i>
              <p>
                网络异常行为检测和预测
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview" style="font-size: small">
              <li class="nav-item">
                <a href="https://www.sigs.tsinghua.edu.cn/" target="_blank" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>网络流量异常检测</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="http://[2001:250:200:5::1:221]:60004/login" target="_blank" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>网络安全事件预测</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-balance-scale"></i>
              <p>
                网络异常行为追踪溯源与定位
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview" style="font-size: small">
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>网络异常行为追踪溯源与定位子系统</p>
                </a>
              </li>
            </ul>
          </li>
          <!--<li class="nav-item">
            <a href="/driver" class="nav-link">
              <i class="nav-icon fas fa-cloud"></i>
              <p>
                Driver Management
              </p>
            </a>
          </li>-->
          <li class="nav-item" style="bottom: 5px;position: fixed;">
            <a href="/status" class="nav-link">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                服务器运行状态
              </p>
            </a>
          </li>
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>服务器状态</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="/home">主页</a></li>
              <li class="breadcrumb-item active">服务器状态</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <section class="content">
        <!-- job-list -->
        <div class="card card-primary" style="">
          <div class="card-header" style="">
            <h3 class="card-title" style="color: white">
                <i class="fas fa-tachometer-alt"></i>
                &nbsp;{{ driver.name }}
            </h3>
          </div>
          <!-- /.card-header -->
            <div class="card-body">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th style="width: 10px">ID</th>
                  <th>Username</th>
                  <th>IP:Port</th>
                  <th>ConnectType</th>
                  <th>OS Info</th>
                  <th>CPU(%)</th>
                  <th>Memory(:)</th>
                  <th>Storage(:)</th>
                  <th style="text-align: center">Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ driver.id }}</td>
                  <td>{{ driver.username }}</td>
                  <td>{{ driver.ip }}:{{ driver.port }}</td>
                  <td>{{ driver.type }}</td>
                  <td>{{ driver.osinfo }}</td>
                  <td>{{ driver.cpu }}</td>
                  <td>{{ driver.memory }}</td>
                  <td>{{ driver.storage }}</td>
                  <td style="text-align: center">
                      {% if driver.status == 'error' %}
                      <span class="badge bg-danger">{{ driver.status }}</span>
                      {% elif driver.status == 'working' %}
                      <span class="badge bg-primary">{{ driver.status }}</span>
                      {% elif driver.status == 'available' %}
                      <span class="badge bg-success">{{ driver.status }}</span>
                      {% endif %}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="card card-primary card-outline card-tabs">
          <div class="card-header p-0 pt-1 border-bottom-0">
            <ul class="nav nav-tabs" id="custom-tabs-three-tab" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="custom-overview-tab" data-toggle="pill" href="#custom-tabs-three-home" role="tab" aria-controls="custom-tabs-three-home" aria-selected="true">服务器状态</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="custom-jobs-tab" data-toggle="pill" href="#custom-tabs-three-settings" role="tab" aria-controls="custom-tabs-three-settings" aria-selected="false">任务列表</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="custom-info-tab" data-toggle="pill" href="#custom-tabs-three-profile" role="tab" aria-controls="custom-tabs-three-profile" aria-selected="false">详细信息</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="custom-shell-tab" data-toggle="pill" href="#custom-tabs-three-messages" role="tab" aria-controls="custom-tabs-three-messages" aria-selected="false">Shell</a>
              </li>
            </ul>
          </div>
          <div class="card-body">
            <div class="tab-content" id="custom-tabs-three-tabContent">
              <div class="tab-pane fade show active" id="custom-tabs-three-home" role="tabpanel" aria-labelledby="custom-overview-tab">
                  <iframe src="http://101.43.253.225:3000/d/XfPEceY7k/system-status?orgId=1&theme=light&kiosk=tv&from=now-30m&to=now&refresh=10s" width="100%" height="1030px" frameborder="0"></iframe>
              </div>
              <div class="tab-pane fade" id="custom-tabs-three-settings" role="tabpanel" aria-labelledby="custom-jobs-tab">
                  <div>

                  </div>
              </div>
              <div class="tab-pane fade" id="custom-tabs-three-profile" role="tabpanel" aria-labelledby="custom-info-tab">
                  <div>

                  </div>
              </div>
              <div class="tab-pane fade" id="custom-tabs-three-messages" role="tabpanel" aria-labelledby="custom-shell-tab">
                  <div>

                  </div>
              </div>
            </div>
          </div>
              <!-- /.card -->
            </div>

    </section>
  </div>
  <!-- /.content-wrapper -->

  <footer class="main-footer">
    <div class="float-right d-none d-sm-block">
      <b>Version</b> 1.0.0-rc
    </div>
    <strong>Copyright &copy; 2018-2022 <a href="https://www.sigs.tsinghua.edu.cn/">SIGS.Tsinghua</a>.</strong> All rights reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->
<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
<!-- jQuery UI 1.11.4 -->
<script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
<!-- Bootstrap4 Duallistbox -->
<script src="{% static 'plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js' %}"></script>
<!-- InputMask -->
<script src="{% static 'plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'plugins/inputmask/jquery.inputmask.min.js' %}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
<!-- Bootstrap -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- Ekko Lightbox -->
<script src="{% static 'plugins/ekko-lightbox/ekko-lightbox.min.js' %}"></script>
<script src="{% static 'dist/js/adminlte.min.js' %}"></script>
<!-- Filterizr-->
<script src="{% static 'plugins/filterizr/jquery.filterizr.min.js' %}"></script>
<!-- date-range-picker -->
<script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button)
</script>
<script>
    //Date range picker with time picker
    $('#reservationtime').daterangepicker({
      timePicker: true,
      timePickerIncrement: 30,
      locale: {
        format: 'MM/DD/YYYY hh:mm A'
      }
    })
</script>
<!-- jQuery Knob -->
<script src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
<!-- Sparkline -->
<script src="{% static 'plugins/sparklines/sparkline.js' %}"></script>
<!-- uPlot -->
<script src="{% static 'plugins/uplot/uPlot.iife.min.js' %}"></script>
<script>
  $(function () {
    /* jQueryKnob */
    $('.knob').knob({
        width: (document.getElementById('knobChart').offsetWidth)-50,
      /*change : function (value) {
       //console.log("change : " + value);
       },
       release : function (value) {
       console.log("release : " + value);
       },
       cancel : function () {
       console.log("cancel : " + this.value);
       },*/
      draw: function () {

        // "tron" case
        if (this.$.data('skin') == 'tron') {

          var a   = this.angle(this.cv)  // Angle
            ,
              sa  = this.startAngle          // Previous start angle
            ,
              sat = this.startAngle         // Start angle
            ,
              ea                            // Previous end angle
            ,
              eat = sat + a                 // End angle
            ,
              r   = true

          this.g.lineWidth = this.lineWidth

          this.o.cursor
          && (sat = eat - 0.3)
          && (eat = eat + 0.3)

          if (this.o.displayPrevious) {
            ea = this.startAngle + this.angle(this.value)
            this.o.cursor
            && (sa = ea - 0.3)
            && (ea = ea + 0.3)
            this.g.beginPath()
            this.g.strokeStyle = this.previousColor
            this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false)
            this.g.stroke()
          }

          this.g.beginPath()
          this.g.strokeStyle = r ? this.o.fgColor : this.fgColor
          this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false)
          this.g.stroke()

          this.g.lineWidth = 2
          this.g.beginPath()
          this.g.strokeStyle = this.o.fgColor
          this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false)
          this.g.stroke()

          return false
        }
      }
    })
    /* END JQUERY KNOB */

  })

</script>
<!-- Page specific script -->
<script>
  $(function () {
    /* uPlot
     * -------
     * Here we will create a few charts using uPlot
     */

    function getSize(elementId) {
      return {
        width: document.getElementById(elementId).offsetWidth,
        height: document.getElementById(elementId).offsetHeight,
      }
    }

    let dataMemory = [
      [0, 1, 2, 3, 4, 5, 6],
      [28, 48, 40, 19, 86, 27, 90]
    ];

    let dataCpuMemory = [
      [0, 1, 2, 3, 4, 5, 6,7,8],
      [28, 48, 40, 19, 86, 27, 90,20,20],
      [65, 59, 80, 81, 56, 55, 40,40,11]
    ];

    let dataPacket = [
      [0, 1, 2, 3, 4, 5, 6,7,8,9,10],
      [28, 48, 40, 19, 86, 27, 90,100,100,99,90],
      [65, 59, 80, 81, 56, 55, 40,45,50,24,60]
    ];

    //--------------
    //- AREA CHART -
    //--------------

    const optsCpuMemoryChart = {
      ... getSize('cpuMemoryChart'),
      scales: {
        x: {
          time: false,
        },
        y: {
          range: [0, 100],
        },
      },
      series: [
        {},
        {
          label: "CPU",
          fill: 'rgba(60,141,188,0.7)',
          stroke: 'rgba(60,141,188,1)',
        },
        {
          label: "Memory",
          stroke: '#c1c7d1',
          fill: 'rgba(210, 214, 222, .7)',
        },
      ],
        axes: [
            {
                label: "Time Duration",
                labelSize: 20,
            },
            {
                space: 50,
                side: 1,
                label: "CPU/Memory Ratio",
                labelGap: 8,
                labelSize: 28,
                stroke: "black",
            }
        ]
    };

    const optsPacketChart = {
      ... getSize('packetChart'),
      scales: {
        x: {
          time: false,
        },
        y: {
          range: [0, 100],
        },
      },
      series: [
        {},
        {
          fill: 'rgba(60,141,188,0.7)',
          stroke: 'rgba(60,141,188,1)',
        },
        {
          stroke: '#c1c7d1',
          fill: 'rgba(210, 214, 222, .7)',
        },
      ],
    };

    let cpuMemoryChart = new uPlot(optsCpuMemoryChart, dataCpuMemory, document.getElementById('cpuMemoryChart'));
    let packetChart = new uPlot(optsPacketChart, dataPacket, document.getElementById('packetChart'));

    const optsMemoryChart = {
      ... getSize('memoryChart'),
      scales: {
        x: {
          time: false,
        },
        y: {
          range: [0, 100],
        },
      },
      series: [
        {},
        {
          fill: 'rgba(60,141,188,0.7)',
          stroke: 'rgba(60,141,188,1)',
        },
      ],
    };

    let memoryChart = new uPlot(optsMemoryChart, dataMemory, document.getElementById('memoryChart'));

    window.addEventListener("resize", e => {
      memoryChart.setSize(getSize('memoryChart'));
      packetChart.setSize(getSize('packetChart'));
      cpuMemoryChart.setSize(getSize('cpuMemoryChart'))
    });

  })

</script>
</body>
</html>
